@using Demo01.Shared.Resources
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<Demo01.Shared.Resources.SharedResources> Localizer
@{
    ViewData["Title"] = "IQC Dashboard - T·ªïng quan ch·∫•t l∆∞·ª£ng";
    ViewData["Page"] = "iqc-dashboard";
}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    /* Modern Dashboard Styles */
    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        margin-bottom: 20px;
    }
    
    /* Header */
    .dashboard-header {
        text-align: center;
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .dashboard-title {
        font-size: 32px;
        font-weight: 600;
        color: #111827;
        margin: 0 0 8px 0;
        letter-spacing: -0.025em;
    }
    
    .dashboard-subtitle {
        font-size: 16px;
        color: #6b7280;
        margin: 0;
        font-weight: 400;
    }
    
    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
    }
    
    .stat-card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        text-align: center;
        transition: all 0.2s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
        font-size: 28px;
        margin-bottom: 12px;
        opacity: 0.8;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 4px;
        letter-spacing: -0.025em;
    }
    
    .stat-label {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 8px;
        font-weight: 500;
    }
    
    .stat-change {
        font-size: 12px;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 6px;
    }
    
    .stat-change.positive {
        background: #dcfce7;
        color: #166534;
    }
    
    .stat-change.negative {
        background: #fef2f2;
        color: #991b1b;
    }
    
    /* Charts */
    .charts-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }
    
    .chart-container {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
    }
    
    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .chart-icon {
        font-size: 18px;
        opacity: 0.7;
    }
    
    /* Tables */
    .table-container {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        margin-bottom: 32px;
    }
    
    .table-title {
        font-size: 18px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .table {
        margin-bottom: 0;
    }
    
    .table th {
        background: #f9fafb;
        border-top: none;
        font-weight: 600;
        color: #374151;
        font-size: 14px;
        padding: 12px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .table td {
        padding: 12px;
        vertical-align: middle;
        border-top: 1px solid #f3f4f6;
        font-size: 14px;
    }
    
    .table tbody tr:hover {
        background: #f9fafb;
    }
    
    /* Filters */
    .filters-container {
        background: #f9fafb;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 32px;
        border: 1px solid #e5e7eb;
    }
    
    .filters-row {
        display: flex;
        gap: 24px;
        align-items: end;
        flex-wrap: wrap;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        min-width: 160px;
    }
    
    .filter-label {
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 14px;
    }
    
    .filter-control {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        font-size: 14px;
        color: #374151;
        transition: border-color 0.2s ease;
    }
    
    .filter-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Progress Section */
    .progress-container {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        margin-bottom: 32px;
    }
    
    .progress-item {
        margin-bottom: 20px;
    }
    
    .progress-item:last-child {
        margin-bottom: 0;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .progress-label-text {
        font-weight: 500;
        color: #374151;
        font-size: 14px;
    }
    
    .progress-label-value {
        font-weight: 600;
        color: #111827;
        font-size: 14px;
    }
    
    .progress-bar {
        height: 8px;
        background: #f3f4f6;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: #3b82f6;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    /* Status Badges */
    .status-badge {
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }
    
    .status-badge.passed {
        background: #dcfce7;
        color: #166534;
    }
    
    .status-badge.failed {
        background: #fef2f2;
        color: #991b1b;
    }
    
    .status-badge.pending {
        background: #fef3c7;
        color: #92400e;
    }
    
    .status-badge.hold {
        background: #f3f4f6;
        color: #374151;
    }
    
    .status-badge.critical {
        background: #fef2f2;
        color: #991b1b;
    }
    
    .status-badge.investigating {
        background: #dbeafe;
        color: #1e40af;
    }
    
   
    /* Animations */
    .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
    }
    
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Responsive - Mobile */
    @@media (max-width: 768px) {
        .dashboard-container {
            padding: 12px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .dashboard-header {
            padding-bottom: 16px;
            margin-bottom: 20px;
        }
        
        .dashboard-title {
            font-size: 20px;
            line-height: 1.3;
        }
        
        .dashboard-subtitle {
            font-size: 13px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            padding: 16px;
        }
        
        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 24px;
        }
        
        .stat-label {
            font-size: 13px;
        }
        
        .charts-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .chart-container {
            padding: 16px;
        }
        
        .chart-title {
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        .filters-container {
            padding: 16px;
        }
        
        .filters-row {
            grid-template-columns: 1fr !important;
            gap: 12px;
        }
        
        .filter-group {
            min-width: auto;
        }
        
        .table-container {
            padding: 16px;
            overflow-x: auto;
        }
        
        .table-title {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
            font-size: 16px;
        }
        
        .table-responsive {
            display: block;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table {
            font-size: 12px;
            white-space: nowrap;
            min-width: 800px;
        }
        
        .table th,
        .table td {
            padding: 8px;
            font-size: 12px;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        .btn-filter {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .progress-container {
            padding: 16px;
        }
    }
    
    @@media (max-width: 576px) {
        .dashboard-container {
            padding: 8px;
        }
        
        .dashboard-title {
            font-size: 18px;
        }
        
        .dashboard-subtitle {
            font-size: 12px;
        }
        
        .stat-card {
            padding: 12px;
        }
        
        .stat-icon {
            font-size: 20px;
        }
        
        .stat-value {
            font-size: 20px;
        }
        
        .chart-container {
            padding: 12px;
        }
        
        .chart-title {
            font-size: 14px;
        }
        
        .table {
            font-size: 11px;
        }
        
        .table th,
        .table td {
            padding: 6px;
            font-size: 11px;
        }
        
        .status-badge {
            padding: 3px 6px;
            font-size: 10px;
        }
    }
    
    .table {
        margin: 0;
    }
    
    .table th {
        background: #f8f9fa;
        border: none;
        font-weight: 600;
        color: #495057;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 15px;
    }
    
    .table td {
        border: none;
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #f1f3f4;
    }
    
    .table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-badge.passed {
        background: #d4edda;
        color: #155724;
    }
    
    .status-badge.failed {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-badge.pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-badge.hold {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .status-badge.critical {
        background: #f8d7da;
        color: #721c24;
    }
    
    .status-badge.major {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-badge.minor {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .status-badge.investigating {
        background: #e2e3e5;
        color: #383d41;
    }
    
    .status-badge.resolved {
        background: #d4edda;
        color: #155724;
    }
    
    /* Progress Bars */
    .progress-container {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
    }
    
    .progress-item {
        margin-bottom: 20px;
    }
    
    .progress-item:last-child {
        margin-bottom: 0;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .progress-label-text {
        font-weight: 500;
        color: #333;
        font-size: 14px;
    }
    
    .progress-label-value {
        font-weight: 600;
        color: #007bff;
        font-size: 14px;
    }
    
    .progress-bar {
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #007bff, #0056b3);
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    /* Filters */
    .filters-container {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
    }
    
    .filters-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-label {
        font-size: 12px;
        font-weight: 600;
        color: #666;
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .filter-control {
        padding: 10px 12px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        transition: border-color 0.2s ease;
    }
    
    .filter-control:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
    }
    
    .btn-filter {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
    }
    
    .btn-filter:hover {
        background: #0056b3;
    }
    
    /* Responsive - Tablet and below */
    @@media (max-width: 1200px) {
        .charts-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }
    }
    
    @@media (max-width: 1024px) {
        .dashboard-container {
            padding: 16px;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .dashboard-title {
            font-size: 26px;
        }
        
        .chart-container {
            padding: 20px;
        }
        
        .table-container {
            padding: 20px;
        }
        
        .filters-row {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .filter-group:last-child {
            grid-column: 1 / -1;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .table {
            min-width: 700px;
            font-size: 13px;
        }
    }
    
    @@media (max-width: 992px) {
        .dashboard-title {
            font-size: 24px;
        }
        
        .dashboard-subtitle {
            font-size: 14px;
        }
        
        .stat-value {
            font-size: 24px;
        }
    }
    
    @@media (min-width: 769px) and (max-width: 1024px) {
        .table {
            font-size: 13px;
        }
        
        .table th,
        .table td {
            padding: 10px;
        }
        
        .chart-title {
            font-size: 17px;
        }
    }
    
    /* Animation */
    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
    }
    
    /* Chart placeholder */
    .chart-placeholder {
        height: 300px;
        background: #f8f9fa;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        font-size: 14px;
        border: 2px dashed #dee2e6;
    }
    
    .chart-placeholder.large {
        height: 400px;
    }
    
    /* Modal styles */
    .modal-content {
        border-radius: 12px;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px 12px 0 0;
    }
    
    .modal-title {
        font-weight: 600;
    }
    
    .btn-close {
        filter: invert(1);
    }
    
    /* Toast styles */
    .toast-container {
        z-index: 1055;
    }
    
    .toast {
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* Canvas responsiveness */
    canvas {
        max-width: 100%;
        height: auto !important;
    }
    
    /* Prevent horizontal scroll on mobile */
    body {
        overflow-x: hidden;
    }
    
    /* Additional mobile fixes */
    @@media (max-width: 768px) {
        .modal-dialog {
            margin: 0.5rem;
        }
        
        .modal-content {
            max-height: calc(100vh - 1rem);
        }
        
        .chart-container canvas {
            max-width: 100%;
        }
        
        .table-responsive {
            border: none;
        }
    }
    
    @@media (max-width: 480px) {
        .dashboard-subtitle {
            font-size: 11px;
        }
        
        .stat-change {
            font-size: 10px;
            padding: 2px 6px;
        }
    }
    
    /* iPad specific fixes */
    @@media (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @@media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
        .dashboard-container {
            max-width: 100%;
        }
        
        .stats-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .charts-grid {
            grid-template-columns: 2fr 1fr;
        }
    }
    
    /* Ensure proper max-width on all screen sizes */
    @@media (min-width: 1400px) {
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }
    }
</style>

<div class="container-fluid py-3 px-md-4">
    <!-- Header -->
    <div class="text-center mb-4 border-bottom pb-3">
        <h1 class="h2 fw-bold mb-2">üìä IQC ƒê·∫ßu v√†o T·ªïng quan - Ki·ªÉm so√°t ch·∫•t l∆∞·ª£ng v·∫£i ƒë·∫ßu v√†o</h1>
        <p class="text-muted mb-0">T·ªïng quan ch·∫•t l∆∞·ª£ng v·∫£i ƒë·∫ßu v√†o cho s·∫£n xu·∫•t d√π l∆∞·ª£n - C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <span id="lastUpdate">@DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span></p>
    </div>

    <!-- Filters -->
    <div class="bg-light rounded p-3 mb-4 shadow-sm">
        <div class="row g-3 align-items-end">
            <div class="col-12 col-md-6 col-lg">
                <label class="form-label small fw-bold text-uppercase text-muted">Kho·∫£ng th·ªùi gian</label>
                <select class="form-select" id="timeRange">
                    <option value="today">H√¥m nay</option>
                    <option value="week" selected>Tu·∫ßn n√†y</option>
                    <option value="month">Th√°ng n√†y</option>
                    <option value="quarter">Qu√Ω n√†y</option>
                    <option value="year">NƒÉm nay</option>
                </select>
            </div>
            <div class="col-12 col-md-6 col-lg">
                <label class="form-label small fw-bold text-uppercase text-muted">Nh√† cung c·∫•p</label>
                <select class="form-select" id="supplierFilter">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="Dominico">Dominico</option>
                    <option value="Porcher">Porcher</option>
                </select>
            </div>
            <div class="col-12 col-md-6 col-lg">
                <label class="form-label small fw-bold text-uppercase text-muted">Lo·∫°i v·∫£i</label>
                <select class="form-select" id="materialFilter">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="polyester">V·∫£i Polyester</option>
                    <option value="nylon">V·∫£i Nylon</option>
                    <option value="ripstop">V·∫£i Ripstop</option>
                    <option value="canvas">V·∫£i Canvas</option>
                    <option value="oxford">V·∫£i Oxford</option>
                </select>
            </div>
            <div class="col-12 col-md-6 col-lg">
                <label class="form-label small fw-bold text-uppercase text-muted">Tr·∫°ng th√°i</label>
                <select class="form-select" id="statusFilter">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="passed">ƒê·∫°t</option>
                    <option value="failed">Kh√¥ng ƒë·∫°t</option>
                    <option value="pending">Ch·ªù ki·ªÉm</option>
                    <option value="hold">T·∫°m gi·ªØ</option>
                </select>
            </div>
            <div class="col-12 col-md-6 col-lg-auto">
                <button class="btn btn-primary w-100" onclick="applyFilters()">üîç √Åp d·ª•ng</button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-3 g-md-4 mb-4">
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card border-success text-center h-100 shadow-sm">
                <div class="card-body">
                    <div class="fs-3 mb-2">‚úÖ</div>
                    <h3 class="fw-bold mb-1" id="totalPassed">0</h3>
                    <p class="text-muted small mb-2">Phi·∫øu ƒë·∫°t chu·∫©n</p>
                    <span class="badge bg-success" id="passedChange">+0%</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card border-danger text-center h-100 shadow-sm">
                <div class="card-body">
                    <div class="fs-3 mb-2">‚ùå</div>
                    <h3 class="fw-bold mb-1" id="totalFailed">0</h3>
                    <p class="text-muted small mb-2">Phi·∫øu kh√¥ng ƒë·∫°t</p>
                    <span class="badge bg-danger" id="failedChange">+0%</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card border-warning text-center h-100 shadow-sm">
                <div class="card-body">
                    <div class="fs-3 mb-2">‚è≥</div>
                    <h3 class="fw-bold mb-1" id="totalPending">0</h3>
                    <p class="text-muted small mb-2">ƒêang ch·ªù ki·ªÉm</p>
                    <span class="badge bg-warning text-dark" id="pendingChange">+0%</span>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="card border-primary text-center h-100 shadow-sm">
                <div class="card-body">
                    <div class="fs-3 mb-2">üìà</div>
                    <h3 class="fw-bold mb-1" id="passRate">0%</h3>
                    <p class="text-muted small mb-2">T·ª∑ l·ªá ƒë·∫°t chu·∫©n</p>
                    <span class="badge bg-primary" id="rateChange">+0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
        <!-- Main Chart -->
        <div class="col-12 col-lg-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title d-flex align-items-center mb-3">
                        <span class="me-2">üìä</span>
                        Xu h∆∞·ªõng ch·∫•t l∆∞·ª£ng theo th·ªùi gian
                    </h5>
                    <canvas id="trendChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Side Chart -->
        <div class="col-12 col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title d-flex align-items-center mb-3">
                        <span class="me-2">ü•ß</span>
                        Ph√¢n b·ªë theo nh√† cung c·∫•p (Dominico vs Porcher)
                    </h5>
                    <canvas id="supplierChart" width="300" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Status Table -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">üì¶ T√¨nh tr·∫°ng c√°c l√¥ ƒëang ki·ªÉm tra</h5>
            <button class="btn btn-outline-primary btn-sm" onclick="refreshData()">üîÑ L√†m m·ªõi</button>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>M√£ l√¥</th>
                        <th>Nh√† cung c·∫•p</th>
                        <th>S·ªë cu·ªôn</th>
                        <th>Lo·∫°i v·∫£i</th>
                        <th>Ng√†y nh·∫≠n</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Ti·∫øn ƒë·ªô</th>
                        <th>∆Øu ti√™n</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="batchStatusTable">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
            </div>
        </div>
    </div>

    <!-- Recent Inspections Table -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">üìã Phi·∫øu ki·ªÉm g·∫ßn ƒë√¢y</h5>
            <button class="btn btn-outline-primary btn-sm" onclick="refreshData()">üîÑ L√†m m·ªõi</button>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>M√£ phi·∫øu</th>
                        <th>Nh√† cung c·∫•p</th>
                        <th>Lo·∫°i v·∫£i</th>
                        <th>Ng√†y ki·ªÉm</th>
                        <th>Ng∆∞·ªùi ki·ªÉm</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>T·ª∑ l·ªá ƒë·∫°t</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="recentInspectionsTable">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
            </div>
        </div>
    </div>

    <!-- Top Defects Section -->
    <div class="row g-4 mb-4">
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title d-flex align-items-center mb-3">
                        <span class="me-2">üîç</span>
                        C√°c l·ªói hay xu·∫•t hi·ªán nh·∫•t
                    </h5>
                    <canvas id="topDefectsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title d-flex align-items-center mb-3">
                        <span class="me-2">üìà</span>
                        Lo·∫°i v·∫£i ƒë∆∞·ª£c IQC nhi·ªÅu nh·∫•t
                    </h5>
                    <canvas id="fabricTypeChart" width="300" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Mock data for dashboard - All data embedded in CSHTML
const mockData = {
    stats: {
        totalPassed: 156,
        totalFailed: 23,
        totalPending: 8,
        passRate: 87.2,
        passedChange: 5.2,
        failedChange: -2.1,
        pendingChange: 1.3,
        rateChange: 3.1
    },
    
    recentInspections: [
        {
            id: 'IQC-2024-001',
            supplier: 'Dominico',
            material: 'V·∫£i Polyester 210D',
            checkDate: '2024-01-15',
            inspector: 'Nguy·ªÖn VƒÉn A',
            status: 'passed',
            passRate: 95,
            action: 'Nh·∫≠p kho',
            materialType: 'polyester',
            batchNumber: 'BATCH-20240115-001',
            lotNumber: 'LOT-20240115-001'
        },
        {
            id: 'IQC-2024-002',
            supplier: 'Porcher',
            material: 'V·∫£i Nylon 70D',
            checkDate: '2024-01-15',
            inspector: 'Tr·∫ßn Th·ªã B',
            status: 'failed',
            passRate: 65,
            action: 'Tr·∫£ v·ªÅ NCC',
            materialType: 'nylon',
            batchNumber: 'BATCH-20240115-002',
            lotNumber: 'LOT-20240115-002'
        },
        {
            id: 'IQC-2024-003',
            supplier: 'Dominico',
            material: 'V·∫£i Ripstop 210D',
            checkDate: '2024-01-14',
            inspector: 'L√™ VƒÉn C',
            status: 'passed',
            passRate: 92,
            action: 'Nh·∫≠p kho',
            materialType: 'ripstop',
            batchNumber: 'BATCH-20240114-001',
            lotNumber: 'LOT-20240114-001'
        },
        {
            id: 'IQC-2024-004',
            supplier: 'Porcher',
            material: 'V·∫£i Canvas 300D',
            checkDate: '2024-01-14',
            inspector: 'Ph·∫°m Th·ªã D',
            status: 'pending',
            passRate: 0,
            action: 'ƒêang ki·ªÉm',
            materialType: 'canvas',
            batchNumber: 'BATCH-20240114-002',
            lotNumber: 'LOT-20240114-002'
        },
        {
            id: 'IQC-2024-005',
            supplier: 'Porcher',
            material: 'V·∫£i Ripstop 190T',
            checkDate: '2024-01-13',
            inspector: 'Ho√†ng VƒÉn E',
            status: 'hold',
            passRate: 78,
            action: 'T·∫°m gi·ªØ',
            materialType: 'ripstop',
            batchNumber: 'BATCH-20240113-001',
            lotNumber: 'LOT-20240113-001'
        },
        {
            id: 'IQC-2024-006',
            supplier: 'Dominico',
            material: 'V·∫£i Polyester 150D',
            checkDate: '2024-01-13',
            inspector: 'V≈© Th·ªã F',
            status: 'passed',
            passRate: 88,
            action: 'Nh·∫≠p kho',
            materialType: 'polyester',
            batchNumber: 'BATCH-20240113-002',
            lotNumber: 'LOT-20240113-002'
        },
        {
            id: 'IQC-2024-007',
            supplier: 'Dominico',
            material: 'V·∫£i Oxford 600D',
            checkDate: '2024-01-12',
            inspector: 'ƒê·∫∑ng VƒÉn G',
            status: 'failed',
            passRate: 45,
            action: 'Tr·∫£ v·ªÅ NCC',
            materialType: 'oxford',
            batchNumber: 'BATCH-20240112-001',
            lotNumber: 'LOT-20240112-001'
        },
        {
            id: 'IQC-2024-008',
            supplier: 'Porcher',
            material: 'V·∫£i Canvas 500D',
            checkDate: '2024-01-12',
            inspector: 'B√πi Th·ªã H',
            status: 'passed',
            passRate: 91,
            action: 'Nh·∫≠p kho',
            materialType: 'canvas',
            batchNumber: 'BATCH-20240112-002',
            lotNumber: 'LOT-20240112-002'
        }
    ],
    
    qualityIssues: [
        {
            id: 'IQC-2024-002',
            issue: 'ƒê·ªô b·ªÅn k√©o v·∫£i Nylon kh√¥ng ƒë·∫°t ti√™u chu·∫©n',
            severity: 'Critical',
            detectedDate: '2024-01-15',
            status: 'Investigating',
            assignee: 'Nguy·ªÖn VƒÉn A',
            action: 'Xem chi ti·∫øt',
            description: 'K·∫øt qu·∫£ ki·ªÉm tra ƒë·ªô b·ªÅn k√©o d·ªçc v·∫£i Nylon ch·ªâ ƒë·∫°t 85N, th·∫•p h∆°n ti√™u chu·∫©n t·ªëi thi·ªÉu 120N',
            impact: 'C√≥ th·ªÉ g√¢y r√°ch v·∫£i trong qu√° tr√¨nh s·ª≠ d·ª•ng d√π l∆∞·ª£n',
            recommendation: 'Tr·∫£ v·ªÅ nh√† cung c·∫•p ƒë·ªÉ ki·ªÉm tra l·∫°i ch·∫•t l∆∞·ª£ng v·∫£i'
        },
        {
            id: 'IQC-2024-005',
            issue: 'M√†u s·∫Øc v·∫£i Ripstop kh√¥ng ƒë·ªìng nh·∫•t',
            severity: 'Major',
            detectedDate: '2024-01-13',
            status: 'Pending',
            assignee: 'Tr·∫ßn Th·ªã B',
            action: 'Xem chi ti·∫øt',
            description: 'M√†u s·∫Øc v·∫£i Ripstop c√≥ s·ª± ch√™nh l·ªách gi·ªØa c√°c ph·∫ßn kh√°c nhau c·ªßa cu·ªôn',
            impact: '·∫¢nh h∆∞·ªüng ƒë·∫øn t√≠nh th·∫©m m·ªπ c·ªßa d√π l∆∞·ª£n th√†nh ph·∫©m',
            recommendation: 'Ki·ªÉm tra l·∫°i quy tr√¨nh nhu·ªôm c·ªßa nh√† cung c·∫•p'
        },
        {
            id: 'IQC-2024-006',
            issue: 'ƒê·ªô ·∫©m v·∫£i Canvas v∆∞·ª£t qu√° gi·ªõi h·∫°n',
            severity: 'Critical',
            detectedDate: '2024-01-12',
            status: 'Resolved',
            assignee: 'L√™ VƒÉn C',
            action: 'Xem chi ti·∫øt',
            description: 'ƒê·ªô ·∫©m c·ªßa v·∫£i Canvas ƒëo ƒë∆∞·ª£c 9.5%, v∆∞·ª£t qu√° ti√™u chu·∫©n cho ph√©p 8%',
            impact: 'C√≥ th·ªÉ g√¢y m·ªëc, h·ªèng v·∫£i trong qu√° tr√¨nh b·∫£o qu·∫£n',
            recommendation: 'S·∫•y kh√¥ v·∫£i tr∆∞·ªõc khi nh·∫≠p kho'
        },
        {
            id: 'IQC-2024-007',
            issue: 'Kh·ªï v·∫£i Oxford kh√¥ng ƒë√∫ng spec',
            severity: 'Major',
            detectedDate: '2024-01-11',
            status: 'Investigating',
            assignee: 'Ph·∫°m Th·ªã D',
            action: 'Xem chi ti·∫øt',
            description: 'Kh·ªï v·∫£i Oxford ƒëo ƒë∆∞·ª£c 1.45m, sai l·ªách so v·ªõi spec 1.50m ¬±0.02m',
            impact: '·∫¢nh h∆∞·ªüng ƒë·∫øn quy tr√¨nh c·∫Øt may d√π l∆∞·ª£n',
            recommendation: 'ƒêi·ªÅu ch·ªânh m√°y c·∫Øt ƒë·ªÉ ph√π h·ª£p v·ªõi kh·ªï v·∫£i th·ª±c t·∫ø'
        },
        {
            id: 'IQC-2024-008',
            issue: 'V·∫øt b·∫©n tr√™n b·ªÅ m·∫∑t v·∫£i Polyester',
            severity: 'Minor',
            detectedDate: '2024-01-10',
            status: 'Resolved',
            assignee: 'Ho√†ng VƒÉn E',
            action: 'Xem chi ti·∫øt',
            description: 'Ph√°t hi·ªán m·ªôt s·ªë v·∫øt b·∫©n nh·ªè tr√™n b·ªÅ m·∫∑t v·∫£i Polyester',
            impact: '·∫¢nh h∆∞·ªüng ƒë·∫øn t√≠nh th·∫©m m·ªπ c·ªßa d√π l∆∞·ª£n',
            recommendation: 'L√†m s·∫°ch v·∫£i tr∆∞·ªõc khi s·ª≠ d·ª•ng'
        }
    ],
    
    progress: {
        currentBatch: 75,
        completedBatch: 85
    },
    
    batchProgress: [
        { supplier: 'Dominico', totalBatches: 15, completedBatches: 13, pendingBatches: 2, progressRate: 86.7 },
        { supplier: 'Porcher', totalBatches: 12, completedBatches: 9, pendingBatches: 3, progressRate: 75.0 }
    ],
    
    currentBatches: [
        {
            batchId: 'BATCH-20240115-001',
            supplier: 'Dominico',
            totalRolls: 25,
            checkedRolls: 20,
            fabricTypes: ['Polyester 210D', 'Nylon 70D'],
            receiveDate: '2024-01-15',
            status: 'in_progress',
            progress: 80,
            inspector: 'Nguy·ªÖn VƒÉn A',
            priority: 'High',
            estimatedCompletion: '2024-01-16'
        },
        {
            batchId: 'BATCH-20240115-002',
            supplier: 'Porcher',
            totalRolls: 18,
            checkedRolls: 0,
            fabricTypes: ['Ripstop 190T'],
            receiveDate: '2024-01-15',
            status: 'pending',
            progress: 0,
            inspector: 'Tr·∫ßn Th·ªã B',
            priority: 'Medium',
            estimatedCompletion: '2024-01-17'
        },
        {
            batchId: 'BATCH-20240114-001',
            supplier: 'Dominico',
            totalRolls: 30,
            checkedRolls: 30,
            fabricTypes: ['Canvas 300D', 'Oxford 600D'],
            receiveDate: '2024-01-14',
            status: 'completed',
            progress: 100,
            inspector: 'L√™ VƒÉn C',
            priority: 'High',
            completedDate: '2024-01-15',
            passRate: 92
        },
        {
            batchId: 'BATCH-20240114-002',
            supplier: 'Porcher',
            totalRolls: 22,
            checkedRolls: 15,
            fabricTypes: ['Polyester 150D'],
            receiveDate: '2024-01-14',
            status: 'in_progress',
            progress: 68,
            inspector: 'Ph·∫°m Th·ªã D',
            priority: 'Low',
            estimatedCompletion: '2024-01-16'
        },
        {
            batchId: 'BATCH-20240113-001',
            supplier: 'Dominico',
            totalRolls: 20,
            checkedRolls: 0,
            fabricTypes: ['Ripstop 210D'],
            receiveDate: '2024-01-13',
            status: 'hold',
            progress: 0,
            inspector: 'Ho√†ng VƒÉn E',
            priority: 'High',
            holdReason: 'Ch·ªù x√°c nh·∫≠n t·ª´ QC Manager',
            estimatedCompletion: '2024-01-18'
        },
        {
            batchId: 'BATCH-20240112-003',
            supplier: 'Porcher',
            totalRolls: 28,
            checkedRolls: 28,
            fabricTypes: ['Nylon 70D', 'Canvas 300D'],
            receiveDate: '2024-01-12',
            status: 'completed',
            progress: 100,
            inspector: 'V≈© Th·ªã F',
            priority: 'Medium',
            completedDate: '2024-01-13',
            passRate: 88
        },
        {
            batchId: 'BATCH-20240111-001',
            supplier: 'Dominico',
            totalRolls: 35,
            checkedRolls: 12,
            fabricTypes: ['Polyester 210D'],
            receiveDate: '2024-01-11',
            status: 'in_progress',
            progress: 34,
            inspector: 'ƒê·∫∑ng VƒÉn G',
            priority: 'High',
            estimatedCompletion: '2024-01-17'
        }
    ],
    
    trendData: [
        { date: '2024-01-08', passed: 12, failed: 2, pending: 1, total: 15 },
        { date: '2024-01-09', passed: 15, failed: 1, pending: 2, total: 18 },
        { date: '2024-01-10', passed: 18, failed: 3, pending: 1, total: 22 },
        { date: '2024-01-11', passed: 14, failed: 2, pending: 3, total: 19 },
        { date: '2024-01-12', passed: 16, failed: 1, pending: 2, total: 19 },
        { date: '2024-01-13', passed: 19, failed: 2, pending: 1, total: 22 },
        { date: '2024-01-14', passed: 17, failed: 1, pending: 2, total: 20 },
        { date: '2024-01-15', passed: 20, failed: 3, pending: 1, total: 24 }
    ],
    
    supplierData: [
        { supplier: 'Dominico', passed: 89, failed: 8, total: 97, passRate: 91.8 },
        { supplier: 'Porcher', passed: 45, failed: 12, total: 57, passRate: 78.9 }
    ],
    
    fabricTypeData: [
        { type: 'polyester', name: 'V·∫£i Polyester', passed: 78, failed: 8, total: 86, passRate: 90.7 },
        { type: 'nylon', name: 'V·∫£i Nylon', passed: 45, failed: 7, total: 52, passRate: 86.5 },
        { type: 'ripstop', name: 'V·∫£i Ripstop', passed: 23, failed: 2, total: 25, passRate: 92.0 },
        { type: 'canvas', name: 'V·∫£i Canvas', passed: 10, failed: 6, total: 16, passRate: 62.5 }
    ],
    
    topDefects: [
        { defect: 'ƒê·ªô b·ªÅn k√©o kh√¥ng ƒë·∫°t', count: 15, percentage: 25.8, supplier: 'Porcher' },
        { defect: 'M√†u s·∫Øc kh√¥ng ƒë·ªìng nh·∫•t', count: 12, percentage: 20.7, supplier: 'Dominico' },
        { defect: 'ƒê·ªô ·∫©m v∆∞·ª£t qu√° gi·ªõi h·∫°n', count: 8, percentage: 13.8, supplier: 'Porcher' },
        { defect: 'Kh·ªï v·∫£i kh√¥ng ƒë√∫ng spec', count: 6, percentage: 10.3, supplier: 'Dominico' },
        { defect: 'V·∫øt b·∫©n tr√™n b·ªÅ m·∫∑t', count: 5, percentage: 8.6, supplier: 'Porcher' },
        { defect: 'ƒê·ªô co r√∫t qu√° m·ª©c', count: 4, percentage: 6.9, supplier: 'Dominico' },
        { defect: 'ƒê·ªô d√†y kh√¥ng ƒë·ªÅu', count: 3, percentage: 5.2, supplier: 'Porcher' },
        { defect: 'Kh√°c', count: 5, percentage: 8.6, supplier: 'Mixed' }
    ],
    
    iqcFrequency: [
        { fabricType: 'polyester', name: 'V·∫£i Polyester', inspections: 86, percentage: 35.2 },
        { fabricType: 'nylon', name: 'V·∫£i Nylon', inspections: 52, percentage: 21.3 },
        { fabricType: 'ripstop', name: 'V·∫£i Ripstop', inspections: 45, percentage: 18.4 },
        { fabricType: 'canvas', name: 'V·∫£i Canvas', inspections: 35, percentage: 14.3 },
        { fabricType: 'oxford', name: 'V·∫£i Oxford', inspections: 26, percentage: 10.6 }
    ]
};

// Initialize dashboard
function initializeDashboard() {
    updateStats();
    populateBatchStatus();
    populateRecentInspections();
    createCharts();
    updateLastUpdateTime();
}

// Update statistics
function updateStats() {
    const stats = mockData.stats;
    
    document.getElementById('totalPassed').textContent = stats.totalPassed;
    document.getElementById('totalFailed').textContent = stats.totalFailed;
    document.getElementById('totalPending').textContent = stats.totalPending;
    document.getElementById('passRate').textContent = stats.passRate + '%';
    
    document.getElementById('passedChange').textContent = '+' + stats.passedChange + '%';
    document.getElementById('failedChange').textContent = stats.failedChange + '%';
    document.getElementById('pendingChange').textContent = '+' + stats.pendingChange + '%';
    document.getElementById('rateChange').textContent = '+' + stats.rateChange + '%';
}

// Populate batch status table
function populateBatchStatus() {
    const tbody = document.getElementById('batchStatusTable');
    tbody.innerHTML = '';
    
    mockData.currentBatches.forEach(batch => {
        const row = document.createElement('tr');
        const statusBadge = getBatchStatusBadge(batch.status);
        const priorityBadge = getPriorityBadge(batch.priority);
        const progressBar = `
            <div class="progress" style="height: 8px;">
                <div class="progress-bar" role="progressbar" style="width: ${batch.progress}%" 
                     aria-valuenow="${batch.progress}" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
            <small class="text-muted">${batch.checkedRolls}/${batch.totalRolls} cu·ªôn</small>
        `;
        
        row.innerHTML = `
            <td><strong>${batch.batchId}</strong></td>
            <td>${batch.supplier}</td>
            <td>${batch.totalRolls}</td>
            <td>${batch.fabricTypes.join(', ')}</td>
            <td>${formatDate(batch.receiveDate)}</td>
            <td>${statusBadge}</td>
            <td>${progressBar}</td>
            <td>${priorityBadge}</td>
            <td>
                <button class="btn btn-outline-primary btn-sm" onclick="viewBatch('${batch.batchId}')">
                    üëÅÔ∏è Xem
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// Get priority badge
function getPriorityBadge(priority) {
    const priorityMap = {
        'High': '<span class="status-badge critical">Cao</span>',
        'Medium': '<span class="status-badge pending">Trung b√¨nh</span>',
        'Low': '<span class="status-badge passed">Th·∫•p</span>'
    };
    return priorityMap[priority] || priority;
}

// Get batch status badge
function getBatchStatusBadge(status) {
    const statusMap = {
        'completed': '<span class="status-badge passed">Ho√†n th√†nh</span>',
        'in_progress': '<span class="status-badge pending">ƒêang ki·ªÉm</span>',
        'pending': '<span class="status-badge pending">Ch·ªù ki·ªÉm</span>',
        'hold': '<span class="status-badge hold">T·∫°m gi·ªØ</span>'
    };
    return statusMap[status] || status;
}

// Populate recent inspections table
function populateRecentInspections() {
    const tbody = document.getElementById('recentInspectionsTable');
    tbody.innerHTML = '';
    
    mockData.recentInspections.forEach(inspection => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${inspection.id}</strong></td>
            <td>${inspection.supplier}</td>
            <td>${inspection.material}</td>
            <td>${formatDate(inspection.checkDate)}</td>
            <td>${inspection.inspector}</td>
            <td><span class="status-badge ${inspection.status}">${getStatusText(inspection.status)}</span></td>
            <td><strong>${inspection.passRate}%</strong></td>
            <td>
                <button class="btn btn-outline-primary btn-sm" onclick="viewInspection('${inspection.id}')">
                    üëÅÔ∏è Xem
                </button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// Populate quality issues table

// Create charts with Chart.js
function createCharts() {
    createTrendChart();
    createSupplierChart();
    createTopDefectsChart();
    createFabricTypeChart();
}

// Create trend chart
function createTrendChart() {
    const ctx = document.getElementById('trendChart').getContext('2d');
    const trendData = mockData.trendData;
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: trendData.map(d => formatDate(d.date)),
            datasets: [
                {
                    label: 'ƒê·∫°t',
                    data: trendData.map(d => d.passed),
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Kh√¥ng ƒë·∫°t',
                    data: trendData.map(d => d.failed),
                    borderColor: '#dc3545',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Ch·ªù ki·ªÉm',
                    data: trendData.map(d => d.pending),
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 2,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// Create supplier pie chart
function createSupplierChart() {
    const ctx = document.getElementById('supplierChart').getContext('2d');
    const supplierData = mockData.supplierData;
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: supplierData.map(s => s.supplier),
            datasets: [{
                data: supplierData.map(s => s.total),
                backgroundColor: [
                    '#007bff',
                    '#28a745'
                ],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const supplier = supplierData[context.dataIndex];
                            return `${supplier.supplier}: ${supplier.total} phi·∫øu (${supplier.passRate}% ƒë·∫°t)`;
                        }
                    }
                }
            }
        }
    });
}

// Create top defects bar chart
function createTopDefectsChart() {
    const ctx = document.getElementById('topDefectsChart').getContext('2d');
    const topDefects = mockData.topDefects.slice(0, 5);
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: topDefects.map(d => d.defect),
            datasets: [{
                label: 'S·ªë l·∫ßn xu·∫•t hi·ªán',
                data: topDefects.map(d => d.count),
                backgroundColor: [
                    '#dc3545',
                    '#fd7e14',
                    '#ffc107',
                    '#20c997',
                    '#6f42c1'
                ],
                borderWidth: 1,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 2,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                },
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
}

// Create fabric type chart
function createFabricTypeChart() {
    const ctx = document.getElementById('fabricTypeChart').getContext('2d');
    const fabricData = mockData.iqcFrequency;
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: fabricData.map(f => f.name),
            datasets: [{
                label: 'S·ªë l·∫ßn ki·ªÉm',
                data: fabricData.map(f => f.inspections),
                backgroundColor: [
                    '#007bff',
                    '#28a745',
                    '#ffc107',
                    '#dc3545',
                    '#6f42c1'
                ],
                borderWidth: 1,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                },
                x: {
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
}

// Helper functions
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN');
}

function getStatusText(status) {
    const statusMap = {
        'passed': 'ƒê·∫°t',
        'failed': 'Kh√¥ng ƒë·∫°t',
        'pending': 'Ch·ªù ki·ªÉm',
        'hold': 'T·∫°m gi·ªØ'
    };
    return statusMap[status] || status;
}

function updateLastUpdateTime() {
    const now = new Date();
    document.getElementById('lastUpdate').textContent = now.toLocaleString('vi-VN');
}

// Action functions
function applyFilters() {
    const timeRange = document.getElementById('timeRange').value;
    const supplier = document.getElementById('supplierFilter').value;
    const material = document.getElementById('materialFilter').value;
    const status = document.getElementById('statusFilter').value;
    
    console.log('Applying filters:', { timeRange, supplier, material, status });
    
    // Simulate loading
    setTimeout(() => {
        showToast('ƒê√£ √°p d·ª•ng b·ªô l·ªçc!', 'success');
        // In real implementation, this would filter the data and refresh the dashboard
    }, 500);
}

function refreshData() {
    console.log('Refreshing dashboard data...');
    
    // Simulate loading
    setTimeout(() => {
        updateLastUpdateTime();
        showToast('ƒê√£ l√†m m·ªõi d·ªØ li·ªáu!', 'success');
    }, 1000);
}

function viewBatch(batchId) {
    console.log('Viewing batch:', batchId);
    const batch = mockData.currentBatches.find(b => b.batchId === batchId);
    if (batch) {
        showBatchModal(batch);
    }
}

function viewInspection(id) {
    console.log('Viewing inspection:', id);
    const inspection = mockData.recentInspections.find(i => i.id === id);
    if (inspection) {
        showInspectionModal(inspection);
    }
}

function viewIssue(id) {
    console.log('Viewing quality issue:', id);
    const issue = mockData.qualityIssues.find(i => i.id === id);
    if (issue) {
        showIssueModal(issue);
    }
}

function viewAllIssues() {
    console.log('Viewing all quality issues');
    showToast('Xem t·∫•t c·∫£ v·∫•n ƒë·ªÅ ch·∫•t l∆∞·ª£ng', 'info');
}

// Modal functions
function showBatchModal(batch) {
    const modalHtml = `
        <div class="modal fade" id="batchModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Chi ti·∫øt l√¥: ${batch.batchId}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Th√¥ng tin l√¥</h6>
                                <p><strong>Nh√† cung c·∫•p:</strong> ${batch.supplier}</p>
                                <p><strong>T·ªïng cu·ªôn:</strong> ${batch.totalRolls}</p>
                                <p><strong>ƒê√£ ki·ªÉm:</strong> ${batch.checkedRolls}</p>
                                <p><strong>Ng√†y nh·∫≠n:</strong> ${formatDate(batch.receiveDate)}</p>
                                <p><strong>Ng∆∞·ªùi ki·ªÉm:</strong> ${batch.inspector}</p>
                                <p><strong>∆Øu ti√™n:</strong> ${getPriorityBadge(batch.priority)}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>Lo·∫°i v·∫£i trong l√¥</h6>
                                <ul>
                                    ${batch.fabricTypes.map(fabric => `<li>${fabric}</li>`).join('')}
                                </ul>
                                <h6>Ti·∫øn ƒë·ªô</h6>
                                <div class="progress mb-2">
                                    <div class="progress-bar" role="progressbar" style="width: ${batch.progress}%" 
                                         aria-valuenow="${batch.progress}" aria-valuemin="0" aria-valuemax="100">
                                        ${batch.progress}%
                                    </div>
                                </div>
                                <p><strong>Tr·∫°ng th√°i:</strong> ${getBatchStatusBadge(batch.status)}</p>
                                ${batch.estimatedCompletion ? `<p><strong>D·ª± ki·∫øn ho√†n th√†nh:</strong> ${formatDate(batch.estimatedCompletion)}</p>` : ''}
                                ${batch.completedDate ? `<p><strong>Ng√†y ho√†n th√†nh:</strong> ${formatDate(batch.completedDate)}</p>` : ''}
                                ${batch.passRate ? `<p><strong>T·ª∑ l·ªá ƒë·∫°t:</strong> ${batch.passRate}%</p>` : ''}
                                ${batch.holdReason ? `<p><strong>L√Ω do t·∫°m gi·ªØ:</strong> ${batch.holdReason}</p>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                        <button type="button" class="btn btn-primary" onclick="continueBatch('${batch.batchId}')">Ti·∫øp t·ª•c ki·ªÉm</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('batchModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add new modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('batchModal'));
    modal.show();
}

function continueBatch(batchId) {
    console.log('Continuing batch:', batchId);
    showToast(`Ti·∫øp t·ª•c ki·ªÉm l√¥ ${batchId}`, 'info');
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('batchModal'));
    modal.hide();
}

function showInspectionModal(inspection) {
    const modalHtml = `
        <div class="modal fade" id="inspectionModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Chi ti·∫øt phi·∫øu ki·ªÉm: ${inspection.id}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Th√¥ng tin c∆° b·∫£n</h6>
                                <p><strong>Nh√† cung c·∫•p:</strong> ${inspection.supplier}</p>
                                <p><strong>Lo·∫°i v·∫£i:</strong> ${inspection.material}</p>
                                <p><strong>Ng√†y ki·ªÉm:</strong> ${formatDate(inspection.checkDate)}</p>
                                <p><strong>Ng∆∞·ªùi ki·ªÉm:</strong> ${inspection.inspector}</p>
                                <p><strong>Batch:</strong> ${inspection.batchNumber}</p>
                                <p><strong>Lot:</strong> ${inspection.lotNumber}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>K·∫øt qu·∫£</h6>
                                <p><strong>Tr·∫°ng th√°i:</strong> <span class="status-badge ${inspection.status}">${getStatusText(inspection.status)}</span></p>
                                <p><strong>T·ª∑ l·ªá ƒë·∫°t:</strong> ${inspection.passRate}%</p>
                                <p><strong>H√†nh ƒë·ªông:</strong> ${inspection.action}</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                        <button type="button" class="btn btn-primary" onclick="exportReport('${inspection.id}')">Xu·∫•t b√°o c√°o</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('inspectionModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add new modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('inspectionModal'));
    modal.show();
}

function showIssueModal(issue) {
    const modalHtml = `
        <div class="modal fade" id="issueModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Chi ti·∫øt v·∫•n ƒë·ªÅ ch·∫•t l∆∞·ª£ng: ${issue.id}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <h6>M√¥ t·∫£ v·∫•n ƒë·ªÅ</h6>
                        <p>${issue.description}</p>
                        
                        <h6>Th√¥ng tin</h6>
                        <p><strong>M·ª©c ƒë·ªô:</strong> <span class="status-badge ${issue.severity.toLowerCase()}">${issue.severity}</span></p>
                        <p><strong>Ng√†y ph√°t hi·ªán:</strong> ${formatDate(issue.detectedDate)}</p>
                        <p><strong>Tr·∫°ng th√°i:</strong> <span class="status-badge ${issue.status.toLowerCase()}">${issue.status}</span></p>
                        <p><strong>Ng∆∞·ªùi ph·ª• tr√°ch:</strong> ${issue.assignee}</p>
                        
                        <h6>T√°c ƒë·ªông</h6>
                        <p>${issue.impact}</p>
                        
                        <h6>Khuy·∫øn ngh·ªã</h6>
                        <p>${issue.recommendation}</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                        <button type="button" class="btn btn-warning" onclick="assignIssue('${issue.id}')">Ph√¢n c√¥ng x·ª≠ l√Ω</button>
                    </div>
                </div>
            </div>
        </div>
    `;

    // Remove existing modal if any
    const existingModal = document.getElementById('issueModal');
    if (existingModal) {
        existingModal.remove();
    }

    // Add modal to body
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('issueModal'));
    modal.show();
}

function exportReport(id) {
    showToast(`ƒê√£ xu·∫•t b√°o c√°o: IQC_Report_${id}.pdf`, 'success');
}

function assignIssue(id) {
    showToast(`ƒê√£ ph√¢n c√¥ng x·ª≠ l√Ω v·∫•n ƒë·ªÅ: ${id}`, 'success');
}

// Toast notification function
function showToast(message, type = 'info') {
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;

    // Add toast container if not exists
    if (!document.getElementById('toastContainer')) {
        document.body.insertAdjacentHTML('beforeend', '<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>');
    }

    const container = document.getElementById('toastContainer');
    container.insertAdjacentHTML('beforeend', toastHtml);

    // Show toast
    const toastElement = container.lastElementChild;
    const toast = new bootstrap.Toast(toastElement);
    toast.show();

    // Remove toast element after it's hidden
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
}

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
    
    // Auto-refresh every 5 minutes
    setInterval(() => {
        updateLastUpdateTime();
    }, 5 * 60 * 1000);
    
    // Add animation delays
    document.querySelectorAll('.stat-card').forEach((card, index) => {
        card.style.animationDelay = (index * 0.1) + 's';
    });

    document.querySelectorAll('.fade-in-up').forEach((element, index) => {
        element.style.animationDelay = (index * 0.2) + 's';
    });
});
</script>